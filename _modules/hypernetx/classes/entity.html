<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>hypernetx.classes.entity &mdash; HyperNetX 2.0.5 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            HyperNetX
              <img src="../../../_static/hnx_logo_smaller.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installing HyperNetX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../core.html">HyperNetX Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hypergraph101.html">A Gentle Introduction to Hypergraph Mathematics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hypconstructors.html">Hypergraph Constructors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../widget.html">Visualization Widget</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modularity.html">Algorithms: Modularity and Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">HyperNetX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">hypernetx.classes.entity</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for hypernetx.classes.entity</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">ast</span> <span class="kn">import</span> <span class="n">literal_eval</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Hashable</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">csr_matrix</span>

<span class="kn">from</span> <span class="nn">hypernetx.classes.helpers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AttrList</span><span class="p">,</span>
    <span class="n">assign_weights</span><span class="p">,</span>
    <span class="n">remove_row_duplicates</span><span class="p">,</span>
    <span class="n">dict_depth</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span>


<div class="viewcode-block" id="Entity"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity">[docs]</a><span class="k">class</span> <span class="nc">Entity</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for handling N-dimensional data when building network-like models,</span>
<span class="sd">    i.e., :class:`Hypergraph`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    entity : pandas.DataFrame, dict of lists or sets, list of lists or sets, optional</span>
<span class="sd">        If a ``DataFrame`` with N columns,</span>
<span class="sd">        represents N-dimensional entity data (data table).</span>
<span class="sd">        Otherwise, represents 2-dimensional entity data (system of sets).</span>
<span class="sd">        TODO: Test for compatibility with list of Entities and update docs</span>
<span class="sd">    data : numpy.ndarray, optional</span>
<span class="sd">        2D M x N ``ndarray`` of ``ints`` (data table);</span>
<span class="sd">        sparse representation of an N-dimensional incidence tensor with M nonzero cells.</span>
<span class="sd">        Ignored if `entity` is provided.</span>
<span class="sd">    static : bool, default=True</span>
<span class="sd">        If ``True``, entity data may not be altered,</span>
<span class="sd">        and the :attr:`state_dict &lt;_state_dict&gt;` will never be cleared.</span>
<span class="sd">        Otherwise, rows may be added to and removed from the data table,</span>
<span class="sd">        and updates will clear the :attr:`state_dict &lt;_state_dict&gt;`.</span>
<span class="sd">    labels : collections.OrderedDict of lists, optional</span>
<span class="sd">        User-specified labels in corresponding order to ``ints`` in `data`.</span>
<span class="sd">        Ignored if `entity` is provided or `data` is not provided.</span>
<span class="sd">    uid : hashable, optional</span>
<span class="sd">        A unique identifier for the object</span>
<span class="sd">    weights : str or sequence of float, optional</span>
<span class="sd">        User-specified cell weights corresponding to entity data.</span>
<span class="sd">        If sequence of ``floats`` and `entity` or `data` defines a data table,</span>
<span class="sd">            length must equal the number of rows.</span>
<span class="sd">        If sequence of ``floats`` and `entity` defines a system of sets,</span>
<span class="sd">            length must equal the total sum of the sizes of all sets.</span>
<span class="sd">        If ``str`` and `entity` is a ``DataFrame``,</span>
<span class="sd">            must be the name of a column in `entity`.</span>
<span class="sd">        Otherwise, weight for all cells is assumed to be 1.</span>
<span class="sd">    aggregateby : {&#39;sum&#39;, &#39;last&#39;, count&#39;, &#39;mean&#39;,&#39;median&#39;, max&#39;, &#39;min&#39;, &#39;first&#39;, None}</span>
<span class="sd">        Name of function to use for aggregating cell weights of duplicate rows when</span>
<span class="sd">        `entity` or `data` defines a data table, default is &quot;sum&quot;.</span>
<span class="sd">        If None, duplicate rows will be dropped without aggregating cell weights.</span>
<span class="sd">        Effectively ignored if `entity` defines a system of sets.</span>
<span class="sd">    properties : pandas.DataFrame or doubly-nested dict, optional</span>
<span class="sd">        User-specified properties to be assigned to individual items in the data, i.e.,</span>
<span class="sd">        cell entries in a data table; sets or set elements in a system of sets.</span>
<span class="sd">        See Notes for detailed explanation.</span>
<span class="sd">        If ``DataFrame``, each row gives</span>
<span class="sd">        ``[optional item level, item label, optional named properties,</span>
<span class="sd">        {property name: property value}]``</span>
<span class="sd">        (order of columns does not matter; see note for an example).</span>
<span class="sd">        If doubly-nested dict,</span>
<span class="sd">        ``{item level: {item label: {property name: property value}}}``.</span>
<span class="sd">    misc_props_col, level_col, id_col : str, default=&quot;properties&quot;, &quot;level, &quot;id&quot;</span>
<span class="sd">        Column names for miscellaneous properties, level index, and item name in</span>
<span class="sd">        :attr:`properties`; see Notes for explanation.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A property is a named attribute assigned to a single item in the data.</span>

<span class="sd">    You can pass a **table of properties** to `properties` as a ``DataFrame``:</span>

<span class="sd">    +------------+---------+----------------+-------+------------------+</span>
<span class="sd">    | Level      | ID      | [explicit      | [...] | misc. properties |</span>
<span class="sd">    | (optional) |         | property type] |       |                  |</span>
<span class="sd">    +============+=========+================+=======+==================+</span>
<span class="sd">    | 0          | level 0 | property value | ...   | {property name:  |</span>
<span class="sd">    |            | item    |                |       | property value}  |</span>
<span class="sd">    +------------+---------+----------------+-------+------------------+</span>
<span class="sd">    | 1          | level 1 | property value | ...   | {property name:  |</span>
<span class="sd">    |            | item    |                |       | property value}  |</span>
<span class="sd">    +------------+---------+----------------+-------+------------------+</span>
<span class="sd">    | ...        | ...     | ...            | ...   | ...              |</span>
<span class="sd">    +------------+---------+----------------+-------+------------------+</span>
<span class="sd">    | N          | level N | property value | ...   | {property name:  |</span>
<span class="sd">    |            | item    |                |       | property value}  |</span>
<span class="sd">    +------------+---------+----------------+-------+------------------+</span>

<span class="sd">    The Level column is optional. If not provided, properties will be assigned by ID</span>
<span class="sd">    (i.e., if an ID appears at multiple levels, the same properties will be assigned to</span>
<span class="sd">    all occurrences).</span>

<span class="sd">    The names of the Level (if provided) and ID columns must be specified by `level_col`</span>
<span class="sd">    and `id_col`. `misc_props_col` can be used to specify the name of the column to be used</span>
<span class="sd">    for miscellaneous properties; if no column by that name is found,</span>
<span class="sd">    a new column will be created and populated with empty ``dicts``.</span>
<span class="sd">    All other columns will be considered explicit property types.</span>
<span class="sd">    The order of the columns does not matter.</span>

<span class="sd">    This method assumes that there are no rows with the same (Level, ID);</span>
<span class="sd">    if duplicates are found, all but the first occurrence will be dropped.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">entity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">data_cols</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">static</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OrderedDict</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">uid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">weight_col</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cell_weights&quot;</span><span class="p">,</span>
        <span class="n">weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">aggregateby</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">misc_props_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;properties&quot;</span><span class="p">,</span>
        <span class="n">level_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;level&quot;</span><span class="p">,</span>
        <span class="n">id_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># set unique identifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uid</span> <span class="o">=</span> <span class="n">uid</span> <span class="ow">or</span> <span class="kc">None</span>

        <span class="c1"># if static, the original data cannot be altered</span>
        <span class="c1"># the state dict stores all computed values that may need to be updated</span>
        <span class="c1"># if the data is altered - the dict will be cleared when data is added</span>
        <span class="c1"># or removed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_static</span> <span class="o">=</span> <span class="n">static</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># entity data is stored in a DataFrame for basic access without the</span>
        <span class="c1"># need for any label encoding lookups</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># if the entity data is passed as a dict of lists or a list of lists,</span>
        <span class="c1"># we convert it to a 2-column dataframe by exploding each list to cover</span>
        <span class="c1"># one row per element for a dict of lists, the first level/column will</span>
        <span class="c1"># be filled in with dict keys for a list of N lists, 0,1,...,N will be</span>
        <span class="c1"># used to fill the first level/column</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="c1"># convert dict of lists to 2-column dataframe</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">{</span><span class="n">data_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">entity</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">data_cols</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">entity</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
            <span class="p">)</span>

        <span class="c1"># if a 2d numpy ndarray is passed, store it as both a DataFrame and an</span>
        <span class="c1"># ndarray in the state dict</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="c1"># if a dict of labels was passed, use keys as column names in the</span>
            <span class="c1"># DataFrame, translate the dataframe, and store the dict of labels</span>
            <span class="c1"># in the state dict</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>

                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="o">.</span><span class="n">from_codes</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                    <span class="p">)</span>

        <span class="c1"># create an empty Entity</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="c1"># assign a new or existing column of the dataframe to hold cell weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_weight_col</span> <span class="o">=</span> <span class="n">assign_weights</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">weight_col</span><span class="o">=</span><span class="n">weight_col</span>
        <span class="p">)</span>
        <span class="c1"># import ipdb; ipdb.set_trace()</span>
        <span class="c1"># store a list of columns that hold entity data (not properties or</span>
        <span class="c1"># weights)</span>
        <span class="c1"># self._data_cols = list(self._dataframe.columns.drop(self._cell_weight_col))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data_cols</span><span class="p">:</span>
            <span class="c1"># TODO: default arguments fail for empty Entity; data_cols has two elements but _dataframe has only one element</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

        <span class="c1"># each entity data column represents one dimension of the data</span>
        <span class="c1"># (data updates can only add or remove rows, so this isn&#39;t stored in</span>
        <span class="c1"># state dict)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dimsize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">)</span>

        <span class="c1"># remove duplicate rows and aggregate cell weights as needed</span>
        <span class="c1"># import ipdb; ipdb.set_trace()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">remove_row_duplicates</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">,</span>
            <span class="n">weight_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cell_weight_col</span><span class="p">,</span>
            <span class="n">aggregateby</span><span class="o">=</span><span class="n">aggregateby</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># set the dtype of entity data columns to categorical (simplifies</span>
        <span class="c1"># encoding, etc.)</span>
        <span class="c1">### This is automatically done in remove_row_duplicates</span>
        <span class="c1"># self._dataframe[self._data_cols] = self._dataframe[self._data_cols].astype(</span>
        <span class="c1">#     &quot;category&quot;</span>
        <span class="c1"># )</span>

        <span class="c1"># create properties</span>
        <span class="n">item_levels</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span>
        <span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">item_levels</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="n">level_col</span><span class="p">,</span> <span class="n">id_col</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{})</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="n">misc_props_col</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_misc_props_col</span> <span class="o">=</span> <span class="n">misc_props_col</span>
        <span class="k">if</span> <span class="n">properties</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assign_properties</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sparse representation of the data table as an incidence tensor</span>

<span class="sd">        This can also be thought of as an encoding of `dataframe`, where items in each column of</span>
<span class="sd">        the data table are translated to their int position in the `self.labels[column]` list</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>
<span class="sd">            2D array of ints representing rows of the underlying data table as indices in an incidence tensor</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        labels, dataframe</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># generate if not already stored in state dict</span>
        <span class="k">if</span> <span class="s2">&quot;data&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># assumes dtype of data cols is already converted to categorical</span>
                <span class="c1"># and state dict has been properly cleared after updates</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">]</span>
                    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Labels of all items in each column of the underlying data table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict of lists</span>
<span class="sd">            dict of {column name: [item labels]}</span>
<span class="sd">            The order of [item labels] corresponds to the int encoding of each item in `self.data`.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        data, dataframe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># generate if not already stored in state dict</span>
        <span class="k">if</span> <span class="s2">&quot;labels&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">:</span>
            <span class="c1"># assumes dtype of data cols is already converted to categorical</span>
            <span class="c1"># and state dict has been properly cleared after updates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">col</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cell_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cell weights corresponding to each row of the underlying data table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict of {tuple: int or float}</span>
<span class="sd">            Keyed by row of data table (as a tuple)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># generate if not already stored in state dict</span>
        <span class="k">if</span> <span class="s2">&quot;cell_weights&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;cell_weights&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;cell_weights&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span>
                <span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">_cell_weight_col</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;cell_weights&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dimensions of data i.e., the number of distinct items in each level (column) of the underlying data table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple of ints</span>
<span class="sd">            Length and order corresponds to columns of `self.dataframe` (excluding cell weight column)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># generate if not already stored in state dict</span>
        <span class="k">if</span> <span class="s2">&quot;dimensions&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;dimensions&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dimsize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of levels (columns) in the underlying data table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Equal to length of `self.dimensions`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimsize</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">properties</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="c1"># Dev Note: Not sure what this contains, when running tests it contained an empty pandas series</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Properties assigned to items in the underlying data table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Dev Note: This also returned nothing in my harry potter dataset, not sure if it was supposed to contain anything</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;User-defined unique identifier for the `Entity`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hashable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uid</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uidset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Labels of all items in level 0 (first column) of the underlying data table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        frozenset</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        children : Labels of all items in level 1 (second column)</span>
<span class="sd">        uidset_by_level, uidset_by_column :</span>
<span class="sd">            Labels of all items in any level (column); specified by level index or column name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uidset_by_level</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Labels of all items in level 1 (second column) of the underlying data table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        frozenset</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        uidset : Labels of all items in level 0 (first column)</span>
<span class="sd">        uidset_by_level, uidset_by_column :</span>
<span class="sd">            Labels of all items in any level (column); specified by level index or column name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uidset_by_level</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<div class="viewcode-block" id="Entity.uidset_by_level"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.uidset_by_level">[docs]</a>    <span class="k">def</span> <span class="nf">uidset_by_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Labels of all items in a particular level (column) of the underlying data table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        level : int</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        frozenset</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        uidset : Labels of all items in level 0 (first column)</span>
<span class="sd">        children : Labels of all items in level 1 (second column)</span>
<span class="sd">        uidset_by_column : Same functionality, takes the column name instead of level index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_empty</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uidset_by_column</span><span class="p">(</span><span class="n">col</span><span class="p">)</span></div>

<div class="viewcode-block" id="Entity.uidset_by_column"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.uidset_by_column">[docs]</a>    <span class="k">def</span> <span class="nf">uidset_by_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="c1"># Dev Note: This threw an error when trying it on the harry potter dataset,</span>
        <span class="c1"># when trying 0, or 1 for column. I&#39;m not sure how this should be used</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Labels of all items in a particular column (level) of the underlying data table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column : Hashable</span>
<span class="sd">            Name of a column in `self.dataframe`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        frozenset</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        uidset : Labels of all items in level 0 (first column)</span>
<span class="sd">        children : Labels of all items in level 1 (second column)</span>
<span class="sd">        uidset_by_level : Same functionality, takes the level index instead of column name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># generate if not already stored in state dict</span>
        <span class="k">if</span> <span class="s2">&quot;uidset&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;uidset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;uidset&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;uidset&quot;</span><span class="p">][</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;uidset&quot;</span><span class="p">][</span><span class="n">column</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;System of sets representation of the first two levels (columns) of the underlying data table</span>

<span class="sd">        Each item in level 0 (first column) defines a set containing all the level 1</span>
<span class="sd">        (second column) items with which it appears in the same row of the underlying</span>
<span class="sd">        data table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict of `AttrList`</span>
<span class="sd">            System of sets representation as dict of {level 0 item : AttrList(level 1 items)}</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        incidence_dict : same data as dict of list</span>
<span class="sd">        memberships :</span>
<span class="sd">            dual of this representation,</span>
<span class="sd">            i.e., each item in level 1 (second column) defines a set</span>
<span class="sd">        elements_by_level, elements_by_column :</span>
<span class="sd">            system of sets representation of any two levels (columns); specified by level index or column name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimsize</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">AttrList</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uidset</span><span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_by_level</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">incidence_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">T</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;System of sets representation of the first two levels (columns) of the underlying data table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict of list</span>
<span class="sd">            System of sets representation as dict of {level 0 item : AttrList(level 1 items)}</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        elements : same data as dict of AttrList</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">item</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">data</span> <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">elements</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">memberships</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;System of sets representation of the first two levels (columns) of the</span>
<span class="sd">        underlying data table</span>

<span class="sd">        Each item in level 1 (second column) defines a set containing all the level 0</span>
<span class="sd">        (first column) items with which it appears in the same row of the underlying</span>
<span class="sd">        data table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict of `AttrList`</span>
<span class="sd">            System of sets representation as dict of {level 1 item : AttrList(level 0 items)}</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        elements : dual of this representation i.e., each item in level 0 (first column) defines a set</span>
<span class="sd">        elements_by_level, elements_by_column :</span>
<span class="sd">            system of sets representation of any two levels (columns); specified by level index or column name</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_by_level</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<div class="viewcode-block" id="Entity.elements_by_level"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.elements_by_level">[docs]</a>    <span class="k">def</span> <span class="nf">elements_by_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level1</span><span class="p">,</span> <span class="n">level2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;System of sets representation of two levels (columns) of the underlying data table</span>

<span class="sd">        Each item in level1 defines a set containing all the level2 items</span>
<span class="sd">        with which it appears in the same row of the underlying data table</span>

<span class="sd">        Properties can be accessed and assigned to items in level1</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        level1 : int</span>
<span class="sd">            index of level whose items define sets</span>
<span class="sd">        level2 : int</span>
<span class="sd">            index of level whose items are elements in the system of sets</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict of `AttrList`</span>
<span class="sd">            System of sets representation as dict of {level1 item : AttrList(level2 items)}</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        elements, memberships : dual system of sets representations of the first two levels (columns)</span>
<span class="sd">        elements_by_column : same functionality, takes column names instead of level indices</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">col1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">[</span><span class="n">level1</span><span class="p">]</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">[</span><span class="n">level2</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements_by_column</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">)</span></div>

<div class="viewcode-block" id="Entity.elements_by_column"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.elements_by_column">[docs]</a>    <span class="k">def</span> <span class="nf">elements_by_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;System of sets representation of two columns (levels) of the underlying data table</span>

<span class="sd">        Each item in col1 defines a set containing all the col2 items</span>
<span class="sd">        with which it appears in the same row of the underlying data table</span>

<span class="sd">        Properties can be accessed and assigned to items in col1</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        col1 : Hashable</span>
<span class="sd">            name of column whose items define sets</span>
<span class="sd">        col2 : Hashable</span>
<span class="sd">            name of column whose items are elements in the system of sets</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict of `AttrList`</span>
<span class="sd">            System of sets representation as dict of {col1 item : AttrList(col2 items)}</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        elements, memberships : dual system of sets representations of the first two columns (levels)</span>
<span class="sd">        elements_by_level : same functionality, takes level indices instead of column names</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;elements&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;elements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">col2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;elements&quot;</span><span class="p">][</span><span class="n">col1</span><span class="p">]:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">col1</span><span class="p">)</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="n">col2</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;elements&quot;</span><span class="p">][</span><span class="n">col1</span><span class="p">][</span><span class="n">col2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">item</span><span class="p">:</span> <span class="n">AttrList</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">item</span><span class="p">),</span> <span class="n">initlist</span><span class="o">=</span><span class="n">elem</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elements</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;elements&quot;</span><span class="p">][</span><span class="n">col1</span><span class="p">][</span><span class="n">col2</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The underlying data table stored by the Entity</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">isstatic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Dev Note: I&#39;m guessing this is no longer necessary?</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether to treat the underlying data as static or not</span>

<span class="sd">        If True, the underlying data may not be altered, and the state_dict will never be cleared</span>
<span class="sd">        Otherwise, rows may be added to and removed from the data table, and updates will clear the state_dict</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static</span>

<div class="viewcode-block" id="Entity.size"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.size">[docs]</a>    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of items in a level of the underlying data table</span>

<span class="sd">        Equivalent to ``self.dimensions[level]``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        level : int, default=0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        dimensions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Since `level` is not validated, we assume that self.dimensions should be an array large enough to access index `level`</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">level</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the underlying data table is empty or not</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        is_empty : for checking whether a specified level (column) is empty</span>
<span class="sd">        dimsize : 0 if empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimsize</span> <span class="o">==</span> <span class="mi">0</span>

<div class="viewcode-block" id="Entity.is_empty"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.is_empty">[docs]</a>    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether a specified level (column) of the underlying data table is empty or not</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        empty : for checking whether the underlying data table is empty</span>
<span class="sd">        size : number of items in a level (columns); 0 if level is empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span></div>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of items in level 0 (first column)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether an item is contained within any level of the data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">labels</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access into the system of sets representation of the first two levels (columns) given by `elements`</span>

<span class="sd">        Can be used to access and assign properties to an ``item`` in level 0 (first column)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : str</span>
<span class="sd">            label of an item in level 0 (first column)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        AttrList :</span>
<span class="sd">            list of level 1 items in the set defined by ``item``</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        uidset, elements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterates over items in level 0 (first column) of the underlying data table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Iterator</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        uidset, elements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="c1"># Dev Note (Madelyn) : I don&#39;t think this is the intended use of __call__, can we change/deprecate?</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterates over items labels in a specified level (column) of the underlying data table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label_index : int</span>
<span class="sd">            level index</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Iterator</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        labels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">[</span><span class="n">label_index</span><span class="p">]])</span>

    <span class="c1"># def __repr__(self):</span>
    <span class="c1">#     &quot;&quot;&quot;String representation of the Entity</span>

    <span class="c1">#     e.g., &quot;Entity(uid, [level 0 items], {item: {property name: property value}})&quot;</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     str</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     return &quot;hypernetx.classes.entity.Entity&quot;</span>

    <span class="c1"># def __str__(self):</span>
    <span class="c1">#     return &quot;&lt;class &#39;hypernetx.classes.entity.Entity&#39;&gt;&quot;</span>

<div class="viewcode-block" id="Entity.index"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.index">[docs]</a>    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get level index corresponding to a column and (optionally) the index of a value in that column</span>

<span class="sd">        The index of ``value`` is its position in the list given by ``self.labels[column]``, which is used</span>
<span class="sd">        in the integer encoding of the data table ``self.data``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column: str</span>
<span class="sd">            name of a column in self.dataframe</span>
<span class="sd">        value : str, optional</span>
<span class="sd">            label of an item in the specified column</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int or (int, int)</span>
<span class="sd">            level index corresponding to column, index of value if provided</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        indices : for finding indices of multiple values in a column</span>
<span class="sd">        level : same functionality, search for the value without specifying column</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;keyindex&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;keyindex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;keyindex&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;keyindex&quot;</span><span class="p">][</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span>
            <span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;keyindex&quot;</span><span class="p">][</span><span class="n">column</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;index&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">][</span><span class="n">column</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">][</span><span class="n">column</span><span class="p">][</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span>
                <span class="n">column</span>
            <span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;keyindex&quot;</span><span class="p">][</span><span class="n">column</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">][</span><span class="n">column</span><span class="p">][</span><span class="n">value</span><span class="p">],</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Entity.indices"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.indices">[docs]</a>    <span class="k">def</span> <span class="nf">indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get indices of one or more value(s) in a column</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column : str</span>
<span class="sd">        values : str or iterable of str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of int</span>
<span class="sd">            indices of values</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        index : for finding level index of a column and index of a single value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;index&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">][</span><span class="n">column</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">][</span><span class="n">column</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span>
                    <span class="n">column</span>
                <span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">][</span><span class="n">column</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span></div>

<div class="viewcode-block" id="Entity.translate"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given indices of a level and value(s), return the corresponding value label(s)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        level : int</span>
<span class="sd">            level index</span>
<span class="sd">        index : int or list of int</span>
<span class="sd">            value index or indices</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str or list of str</span>
<span class="sd">            label(s) corresponding to value index or indices</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        translate_arr : translate a full row of value indices across all levels (columns)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">]</span></div>

<div class="viewcode-block" id="Entity.translate_arr"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.translate_arr">[docs]</a>    <span class="k">def</span> <span class="nf">translate_arr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Translate a full encoded row of the data table e.g., a row of ``self.data``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coords : tuple of ints</span>
<span class="sd">            encoded value indices, with one value index for each level of the data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of str</span>
<span class="sd">            full row of translated value labels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimsize</span>
        <span class="n">translation</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
            <span class="n">translation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">translation</span></div>

<div class="viewcode-block" id="Entity.level"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.level">[docs]</a>    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">min_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;First level containing the given item label</span>

<span class="sd">        Order of levels corresponds to order of columns in `self.dataframe`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : str</span>
<span class="sd">        min_level, max_level : int, optional</span>
<span class="sd">            inclusive bounds on range of levels to search for item</span>
<span class="sd">        return_index : bool, default=True</span>
<span class="sd">            If True, return index of item within the level</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int, (int, int), or None</span>
<span class="sd">            index of first level containing the item, index of item if `return_index=True`</span>
<span class="sd">            returns None if item is not found</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        index, indices : for finding level and/or value indices when the column is known</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_level</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">max_level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimsize</span><span class="p">:</span>
            <span class="n">max_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimsize</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">[</span><span class="n">min_level</span> <span class="p">:</span> <span class="n">max_level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_level</span><span class="p">,</span> <span class="n">max_level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">lev</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">levels</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">col</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">return_index</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">lev</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s1">&quot; not found.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Entity.add"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the underlying data table with new entity data from multiple sources</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args</span>
<span class="sd">            variable length argument list of Entity and/or representations of entity data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : Entity</span>

<span class="sd">        Warnings</span>
<span class="sd">        --------</span>
<span class="sd">        Adding an element directly to an Entity will not add the</span>
<span class="sd">        element to any Hypergraphs constructed from that Entity, and will cause an error. Use</span>
<span class="sd">        :func:`Hypergraph.add_edge &lt;classes.hypergraph.Hypergraph.add_edge&gt;` or</span>
<span class="sd">        :func:`Hypergraph.add_node_to_edge &lt;classes.hypergraph.Hypergraph \</span>
<span class="sd">            .add_node_to_edge&gt;` instead.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        add_element : update from a single source</span>
<span class="sd">        Hypergraph.add_edge, Hypergraph.add_node_to_edge : for adding elements to a Hypergraph</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Entity.add_elements_from"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.add_elements_from">[docs]</a>    <span class="k">def</span> <span class="nf">add_elements_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg_set</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds arguments from an iterable to the data table one at a time</span>

<span class="sd">        ..deprecated:: 2.0.0</span>
<span class="sd">            Duplicates `add`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        arg_set : iterable</span>
<span class="sd">            list of Entity and/or representations of entity data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : Entity</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">arg_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Entity.add_element"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.add_element">[docs]</a>    <span class="k">def</span> <span class="nf">add_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the underlying data table with new entity data</span>

<span class="sd">        Supports adding from either an existing Entity or a representation of entity</span>
<span class="sd">        (data table or labeled system of sets are both supported representations)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : Entity, `pandas.DataFrame`, or dict of lists or sets</span>
<span class="sd">            new entity data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : Entity</span>

<span class="sd">        Warnings</span>
<span class="sd">        --------</span>
<span class="sd">        Adding an element directly to an Entity will not add the</span>
<span class="sd">        element to any Hypergraphs constructed from that Entity, and will cause an error. Use</span>
<span class="sd">        `Hypergraph.add_edge` or `Hypergraph.add_node_to_edge` instead.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        add : takes multiple sources of new entity data as variable length argument list</span>
<span class="sd">        Hypergraph.add_edge, Hypergraph.add_node_to_edge : for adding elements to a Hypergraph</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Entity</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dataframe</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__add_from_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__add_from_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__add_from_dataframe</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">__add_from_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function to append rows to `self.dataframe`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : pd.DataFrame</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : Entity</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">col</span> <span class="ow">in</span> <span class="n">df</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">):</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">,</span> <span class="n">df</span><span class="p">),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_cell_weight_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_cell_weight_col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">remove_row_duplicates</span><span class="p">(</span>
                <span class="n">new_data</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">,</span>
                <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cell_weight_col</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                <span class="s2">&quot;category&quot;</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<div class="viewcode-block" id="Entity.remove"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes all rows containing specified item(s) from the underlying data table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args</span>
<span class="sd">            variable length argument list of item labels</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : Entity</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        remove_element : remove all rows containing a single specified item</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_element</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Entity.remove_elements_from"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.remove_elements_from">[docs]</a>    <span class="k">def</span> <span class="nf">remove_elements_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg_set</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes all rows containing specified item(s) from the underlying data table</span>

<span class="sd">        ..deprecated: 2.0.0</span>
<span class="sd">            Duplicates `remove`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        arg_set : iterable</span>
<span class="sd">            list of item labels</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : Entity</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">arg_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_element</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Entity.remove_element"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.remove_element">[docs]</a>    <span class="k">def</span> <span class="nf">remove_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes all rows containing a specified item from the underlying data table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item</span>
<span class="sd">            item label</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : Entity</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        remove : same functionality, accepts variable length argument list of item labels</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">updated_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">:</span>
            <span class="n">updated_dataframe</span> <span class="o">=</span> <span class="n">updated_dataframe</span><span class="p">[</span><span class="n">updated_dataframe</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">!=</span> <span class="n">item</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">remove_row_duplicates</span><span class="p">(</span>
            <span class="n">updated_dataframe</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cell_weight_col</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="s2">&quot;category&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">remove_unused_categories</span><span class="p">()</span></div>

<div class="viewcode-block" id="Entity.encode"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.encode">[docs]</a>    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Encode dataframe to numpy array</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : dataframe</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.array</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">encoded_array</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">encoded_array</span></div>

<div class="viewcode-block" id="Entity.incidence_matrix"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.incidence_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">incidence_matrix</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">level1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">level2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">aggregateby</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">csr_matrix</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Incidence matrix representation for two levels (columns) of the underlying data table</span>

<span class="sd">        If `level1` and `level2` contain N and M distinct items, respectively, the incidence matrix will be M x N.</span>
<span class="sd">        In other words, the items in `level1` and `level2` correspond to the columns and rows of the incidence matrix,</span>
<span class="sd">        respectively, in the order in which they appear in `self.labels[column1]` and `self.labels[column2]`</span>
<span class="sd">        (`column1` and `column2` are the column labels of `level1` and `level2`)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        level1 : int, default=0</span>
<span class="sd">            index of first level (column)</span>
<span class="sd">        level2 : int, default=1</span>
<span class="sd">            index of second level</span>
<span class="sd">        weights : bool or dict, default=False</span>
<span class="sd">            If False all nonzero entries are 1.</span>
<span class="sd">            If True all nonzero entries are filled by self.cell_weight</span>
<span class="sd">            dictionary values, use :code:`aggregateby` to specify how duplicate</span>
<span class="sd">            entries should have weights aggregated.</span>
<span class="sd">            If dict of {(level1 item, level2 item): weight value} form;</span>
<span class="sd">            only nonzero cells in the incidence matrix will be updated by dictionary,</span>
<span class="sd">            i.e., `level1 item` and `level2 item` must appear in the same row at least once in the underlying data table</span>
<span class="sd">        aggregateby : {&#39;last&#39;, count&#39;, &#39;sum&#39;, &#39;mean&#39;,&#39;median&#39;, max&#39;, &#39;min&#39;, &#39;first&#39;, &#39;last&#39;, None}, default=&#39;count&#39;</span>
<span class="sd">            Method to aggregate weights of duplicate rows in data table.</span>
<span class="sd">             If None, then all cell weights will be set to 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        scipy.sparse.csr.csr_matrix</span>
<span class="sd">            sparse representation of incidence matrix (i.e. Compressed Sparse Row matrix)</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        index : bool, optional</span>
<span class="sd">            Not used</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        In the context of Hypergraphs, think `level1 = edges, level2 = nodes`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimsize</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Incidence matrix requires two levels of data.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">data_cols</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">[</span><span class="n">level2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">[</span><span class="n">level1</span><span class="p">]]</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_weight_col</span> <span class="k">if</span> <span class="n">weights</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">df</span><span class="p">,</span> <span class="n">weight_col</span> <span class="o">=</span> <span class="n">remove_row_duplicates</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">,</span>
            <span class="n">data_cols</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
            <span class="n">aggregateby</span><span class="o">=</span><span class="n">aggregateby</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">csr_matrix</span><span class="p">(</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">weight_col</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data_cols</span><span class="p">))</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Entity.restrict_to_levels"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.restrict_to_levels">[docs]</a>    <span class="k">def</span> <span class="nf">restrict_to_levels</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">levels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">weights</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">aggregateby</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Entity</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new Entity by restricting to a subset of levels (columns) in the</span>
<span class="sd">        underlying data table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        levels : array-like of int</span>
<span class="sd">            indices of a subset of levels (columns) of data</span>
<span class="sd">        weights : bool, default=False</span>
<span class="sd">            If True, aggregate existing cell weights to get new cell weights</span>
<span class="sd">            Otherwise, all new cell weights will be 1</span>
<span class="sd">        aggregateby : {&#39;sum&#39;, &#39;first&#39;, &#39;last&#39;, &#39;count&#39;, &#39;mean&#39;, &#39;median&#39;, &#39;max&#39;, \</span>
<span class="sd">    &#39;min&#39;, None}, optional</span>
<span class="sd">            Method to aggregate weights of duplicate rows in data table</span>
<span class="sd">            If None or `weights`=False then all new cell weights will be 1</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Extra arguments to `Entity` constructor</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Entity</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If `levels` contains any invalid values</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        EntitySet</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
        <span class="n">invalid_levels</span> <span class="o">=</span> <span class="p">(</span><span class="n">levels</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">levels</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimsize</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid_levels</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid levels: </span><span class="si">{</span><span class="n">levels</span><span class="p">[</span><span class="n">invalid_levels</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">[</span><span class="n">lev</span><span class="p">]</span> <span class="k">for</span> <span class="n">lev</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">weights</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_weight_col</span>
            <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>

        <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">levels</span><span class="p">]</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">remove_unused_levels</span><span class="p">()</span>
        <span class="n">level_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">old</span><span class="p">:</span> <span class="n">new</span> <span class="k">for</span> <span class="n">new</span><span class="p">,</span> <span class="n">old</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">levels</span><span class="p">)}</span>
        <span class="n">new_levels</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">level_map</span><span class="p">)</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">set_levels</span><span class="p">(</span><span class="n">new_levels</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">level_col</span><span class="p">,</span> <span class="n">id_col</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span>
            <span class="n">entity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">cols</span><span class="p">],</span>
            <span class="n">data_cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
            <span class="n">aggregateby</span><span class="o">=</span><span class="n">aggregateby</span><span class="p">,</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
            <span class="n">misc_props_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_misc_props_col</span><span class="p">,</span>
            <span class="n">level_col</span><span class="o">=</span><span class="n">level_col</span><span class="p">,</span>
            <span class="n">id_col</span><span class="o">=</span><span class="n">id_col</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Entity.restrict_to_indices"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.restrict_to_indices">[docs]</a>    <span class="k">def</span> <span class="nf">restrict_to_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new Entity by restricting the data table to rows containing specific items in a given level</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indices : int or iterable of int</span>
<span class="sd">            indices of item label(s) in `level` to restrict to</span>
<span class="sd">        level : int, default=0</span>
<span class="sd">            level index</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Extra arguments to `Entity` constructor</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Entity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">[</span><span class="n">level</span><span class="p">]]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">column</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">:</span>
            <span class="n">entity</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">remove_unused_categories</span><span class="p">()</span>
        <span class="n">restricted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span>
            <span class="n">entity</span><span class="o">=</span><span class="n">entity</span><span class="p">,</span> <span class="n">misc_props_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_misc_props_col</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">prop_idx</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">lv</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">lv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">restricted</span><span class="o">.</span><span class="n">dimsize</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">restricted</span><span class="o">.</span><span class="n">uidset_by_level</span><span class="p">(</span><span class="n">lv</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prop_idx</span><span class="p">]</span>
            <span class="n">restricted</span><span class="o">.</span><span class="n">assign_properties</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">restricted</span></div>

<div class="viewcode-block" id="Entity.assign_properties"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.assign_properties">[docs]</a>    <span class="k">def</span> <span class="nf">assign_properties</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">props</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]],</span>
        <span class="n">misc_col</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">level_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">id_col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign new properties to items in the data table, update :attr:`properties`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        props : pandas.DataFrame or doubly-nested dict</span>
<span class="sd">            See documentation of the `properties` parameter in :class:`Entity`</span>
<span class="sd">        level_col, id_col, misc_col : str, optional</span>
<span class="sd">            column names corresponding to the levels, items, and misc. properties;</span>
<span class="sd">            if None, default to :attr:`_level_col`, :attr:`_id_col`, :attr:`_misc_props_col`,</span>
<span class="sd">            respectively.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># mapping from user-specified level, id, misc column names to internal names</span>
        <span class="c1">### This will fail if there isn&#39;t a level column</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="c1">### Fix to check the shape of properties or redo properties format</span>
            <span class="n">column_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">old</span><span class="p">:</span> <span class="n">new</span>
                <span class="k">for</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">level_col</span><span class="p">,</span> <span class="n">id_col</span><span class="p">,</span> <span class="n">misc_col</span><span class="p">),</span>
                    <span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_misc_props_col</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">old</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">}</span>
            <span class="n">props</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">column_map</span><span class="p">)</span>
            <span class="n">props</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">column_map</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_properties_from_dataframe</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1">### Expects nested dictionary with keys corresponding to level and id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_properties_from_dict</span><span class="p">(</span><span class="n">props</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_properties_from_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private handler for updating :attr:`properties` from a DataFrame</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        props</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        For clarity in in-line developer comments:</span>

<span class="sd">        idx-level</span>
<span class="sd">            refers generally to a level of a MultiIndex</span>
<span class="sd">        level</span>
<span class="sd">            refers specifically to the idx-level in the MultiIndex of :attr:`properties`</span>
<span class="sd">            that stores the level/column id for the item</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># names of property table idx-levels for level and item id, respectively</span>
        <span class="c1"># ``item`` used instead of ``id`` to avoid redefining python built-in func `id`</span>
        <span class="n">level</span><span class="p">,</span> <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span>
        <span class="k">if</span> <span class="n">props</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># props has MultiIndex</span>
            <span class="c1"># drop all idx-levels from props other than level and id (if present)</span>
            <span class="n">extra_levels</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">idx_lev</span> <span class="k">for</span> <span class="n">idx_lev</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="k">if</span> <span class="n">idx_lev</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">props</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">extra_levels</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># if props index is already in the correct format,</span>
            <span class="c1"># enforce the correct idx-level ordering</span>
            <span class="n">props</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">reorder_levels</span><span class="p">((</span><span class="n">level</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># props is not in (level, id) MultiIndex format</span>
            <span class="c1"># if the index matches level or id, drop index to column</span>
            <span class="k">if</span> <span class="n">props</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                <span class="n">props</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">index_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">props</span><span class="p">:</span>
                <span class="n">index_cols</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">props</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">index_cols</span><span class="p">,</span> <span class="n">verify_integrity</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;duplicate (level, ID) rows will be dropped after first occurrence&quot;</span>
                <span class="p">)</span>
                <span class="n">props</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">index_cols</span><span class="p">)</span>
                <span class="n">props</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">index_cols</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_misc_props_col</span> <span class="ow">in</span> <span class="n">props</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">props</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_misc_props_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_misc_props_col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="n">literal_eval</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># data already parsed, no literal eval needed</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;parsed property dict column from string literal&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">props</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">props</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># combine with existing properties</span>
        <span class="c1"># non-null values in new props override existing value</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
        <span class="c1"># update misc. column to combine existing and new misc. property dicts</span>
        <span class="c1"># new props override existing value for overlapping misc. property dict keys</span>
        <span class="n">properties</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_misc_props_col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_misc_props_col</span>
        <span class="p">]</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>
            <span class="n">properties</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_misc_props_col</span><span class="p">],</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">{</span><span class="o">**</span><span class="p">(</span><span class="n">x</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="p">{}),</span> <span class="o">**</span><span class="p">(</span><span class="n">y</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">else</span> <span class="p">{})},</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="p">{},</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_properties_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Private handler for updating :attr:`properties` from a doubly-nested dict</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        props</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: there may be a more efficient way to convert this to a dataframe instead</span>
        <span class="c1">#  of updating one-by-one via nested loop, but checking whether each prop_name</span>
        <span class="c1">#  belongs in a designated existing column or the misc. property dict column</span>
        <span class="c1">#  makes it more challenging</span>
        <span class="c1">#  For now: only use nested loop update if non-misc. columns currently exist</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">props</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">props</span><span class="p">[</span><span class="n">level</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">prop_name</span><span class="p">,</span> <span class="n">prop_val</span> <span class="ow">in</span> <span class="n">props</span><span class="p">[</span><span class="n">level</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">prop_name</span><span class="p">,</span> <span class="n">prop_val</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item_keys</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">level</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">props</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">props</span><span class="p">[</span><span class="n">level</span><span class="p">]],</span>
                <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">props_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">props</span><span class="p">[</span><span class="n">level</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_keys</span><span class="p">]</span>
            <span class="n">props</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">_misc_props_col</span><span class="p">:</span> <span class="n">props_data</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">item_keys</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_properties_from_dataframe</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_property_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">T</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get index in :attr:`properties` of an item of unspecified level</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : hashable</span>
<span class="sd">            name of an item</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        item_key : tuple of (int, hashable)</span>
<span class="sd">            ``(level, item)``</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If `item` is not in :attr:`properties`</span>

<span class="sd">        Warns</span>
<span class="sd">        -----</span>
<span class="sd">        UserWarning</span>
<span class="sd">            If `item` appears in multiple levels, returns the first (closest to 0)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">item_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">drop_level</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>  <span class="c1"># item not in df</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;no properties initialized for &#39;item&#39;: </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">ex</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">item_key</span> <span class="o">=</span> <span class="n">item_loc</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">item_loc</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">item_loc</span><span class="o">.</span><span class="n">sortlevel</span><span class="p">(</span><span class="n">sort_remaining</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">item_key</span> <span class="o">=</span> <span class="n">item_loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;item found in multiple levels: </span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="n">item_loc</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">item_key</span>

<div class="viewcode-block" id="Entity.set_property"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.set_property">[docs]</a>    <span class="k">def</span> <span class="nf">set_property</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">item</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
        <span class="n">prop_name</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">prop_val</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a property of an item</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : hashable</span>
<span class="sd">            name of an item</span>
<span class="sd">        prop_name : hashable</span>
<span class="sd">            name of the property to set</span>
<span class="sd">        prop_val : any</span>
<span class="sd">            value of the property to set</span>
<span class="sd">        level : int, optional</span>
<span class="sd">            level index of the item;</span>
<span class="sd">            required if `item` is not already in :attr:`properties`</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If `level` is not provided and `item` is not in :attr:`properties`</span>

<span class="sd">        Warns</span>
<span class="sd">        -----</span>
<span class="sd">        UserWarning</span>
<span class="sd">            If `level` is not provided and `item` appears in multiple levels,</span>
<span class="sd">            assumes the first (closest to 0)</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        get_property, get_properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">item_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">item_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_property_loc</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;cannot infer &#39;level&#39; when initializing &#39;item&#39; properties&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">ex</span>

        <span class="k">if</span> <span class="n">prop_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item_key</span><span class="p">,</span> <span class="n">prop_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop_val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_misc_props_col</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span><span class="n">prop_name</span><span class="p">:</span> <span class="n">prop_val</span><span class="p">}</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item_key</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_misc_props_col</span><span class="p">:</span> <span class="p">{</span><span class="n">prop_name</span><span class="p">:</span> <span class="n">prop_val</span><span class="p">}</span>
                <span class="p">}</span></div>

<div class="viewcode-block" id="Entity.get_property"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.get_property">[docs]</a>    <span class="k">def</span> <span class="nf">get_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">prop_name</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a property of an item</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : hashable</span>
<span class="sd">            name of an item</span>
<span class="sd">        prop_name : hashable</span>
<span class="sd">            name of the property to get</span>
<span class="sd">        level : int, optional</span>
<span class="sd">            level index of the item</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        prop_val : any</span>
<span class="sd">            value of the property</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            if (`level`, `item`) is not in :attr:`properties`,</span>
<span class="sd">            or if `level` is not provided and `item` is not in :attr:`properties`</span>

<span class="sd">        Warns</span>
<span class="sd">        -----</span>
<span class="sd">        UserWarning</span>
<span class="sd">            If `level` is not provided and `item` appears in multiple levels,</span>
<span class="sd">            assumes the first (closest to 0)</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        get_properties, set_property</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">item_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">item_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_property_loc</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span>  <span class="c1"># item not in properties</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">prop_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item_key</span><span class="p">,</span> <span class="n">prop_name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ex</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">prop_name</span><span class="p">:</span>
                <span class="n">prop_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_misc_props_col</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">prop_name</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;no properties initialized for (&#39;level&#39;,&#39;item&#39;): </span><span class="si">{</span><span class="n">item_key</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">ex</span>

        <span class="k">return</span> <span class="n">prop_val</span></div>

<div class="viewcode-block" id="Entity.get_properties"><a class="viewcode-back" href="../../../classes/classes.html#classes.Entity.get_properties">[docs]</a>    <span class="k">def</span> <span class="nf">get_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all properties of an item</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : hashable</span>
<span class="sd">            name of an item</span>
<span class="sd">        level : int, optional</span>
<span class="sd">            level index of the item</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        prop_vals : dict</span>
<span class="sd">            ``{named property: property value, ...,</span>
<span class="sd">            misc. property column name: {property name: property value}}``</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            if (`level`, `item`) is not in :attr:`properties`,</span>
<span class="sd">            or if `level` is not provided and `item` is not in :attr:`properties`</span>

<span class="sd">        Warns</span>
<span class="sd">        -----</span>
<span class="sd">        UserWarning</span>
<span class="sd">            If `level` is not provided and `item` appears in multiple levels,</span>
<span class="sd">            assumes the first (closest to 0)</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        get_property, set_property</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">item_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">item_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_property_loc</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">prop_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item_key</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;no properties initialized for (&#39;level&#39;,&#39;item&#39;): </span><span class="si">{</span><span class="n">item_key</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">ex</span>

        <span class="k">return</span> <span class="n">prop_vals</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 Battelle Memorial Institute.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>